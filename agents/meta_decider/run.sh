#!/bin/bash
INSTRUCTION_FILE="$1"
TASK=$(cat "$INSTRUCTION_FILE")
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"

echo "ðŸ”§ LLM deciding how to create agent for: $TASK"

RESPONSE=$(curl -s http://localhost:11434/api/generate -d '{
  "model": "llama3",
  "prompt": "Write a shell script that performs the following task and save it to run.sh: '"$TASK"'. Then write a matching agent.yaml and status.json for an agent called '"$AGENT_NAME"'",
  "stream": false
}' | jq -r .response)

AGENT_DIR="agents/$AGENT_NAME"
mkdir -p "$AGENT_DIR"
echo "$RESPONSE" > "$AGENT_DIR/response.txt"

# Extract run.sh block
echo "$RESPONSE" | awk '/```bash/,/```/' | sed '1d;$d' > "$AGENT_DIR/run.sh"
chmod +x "$AGENT_DIR/run.sh"

# Extract agent.yaml block
echo "$RESPONSE" | awk '/```yaml/,/```/' | sed '1d;$d' > "$AGENT_DIR/agent.yaml"

# Touch placeholder status file
echo '{"status": "created", "timestamp": "'$(date)'"}' > "$AGENT_DIR/status.json"

echo "âœ… Agent '$AGENT_NAME' scaffolded. Running it now..."
RESPONSE_FILE="$AGENT_DIR/response.txt"
RUN_FILE="$AGENT_DIR/run.sh"

awk '
  BEGIN { in_block=0 }
  /^\s*```bash\s*$/ { in_block=1; next }
  /^\s*```/ && in_block { exit }
  in_block { print }
' "$RESPONSE_FILE" > "$RUN_FILE"
chmod +x "$RUN_FILE"
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"
AGENT_NAME=$(echo "$TASK" | tr "[:space:]" "_" | tr -cd "[:alnum:]_.-" | tr "[:upper:]" "[:lower:]")
[[ -z "$AGENT_NAME" ]] && AGENT_NAME="auto_agent_$(date +%s)"

echo "ðŸ”§ LLM deciding how to create agent for: $TASK"

RESPONSE=$(curl -s http://localhost:11434/api/generate -d '{
  "model": "llama3",
  "prompt": "Write a shell script that performs the following task and save it to run.sh: '"$TASK"'. Then write a matching agent.yaml and status.json for an agent called '"$AGENT_NAME"'",
  "stream": false
}' | jq -r .response)

AGENT_DIR="agents/$AGENT_NAME"
mkdir -p "$AGENT_DIR"
echo "$RESPONSE" > "$AGENT_DIR/response.txt"

# Extract run.sh block
echo "$RESPONSE" | awk '/```bash/,/```/' | sed '1d;$d' > "$AGENT_DIR/run.sh"
chmod +x "$AGENT_DIR/run.sh"

# Extract agent.yaml block
echo "$RESPONSE" | awk '/```yaml/,/```/' | sed '1d;$d' > "$AGENT_DIR/agent.yaml"

# Touch placeholder status file
echo '{"status": "created", "timestamp": "'$(date)'"}' > "$AGENT_DIR/status.json"

echo "âœ… Agent '$AGENT_NAME' scaffolded. Running it now..."
bash "$AGENT_DIR/run.sh"
